<% provide(:title, "投稿詳細") %>
<div class="show-address"><span><%= @post.map&.address %></span></div>
<style>
#map {
  height: 50vh;
  width: 60vw;
  margin: 0 auto;
}
</style>
<div id="map"></div>
<script>
function initMap() {
    var test = {lat: <%= @post.map&.latitude %>, lng: <%= @post.map&.longitude %>};
    var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 15, 
              center: test
              });
    var transitLayer = new google.maps.TransitLayer();
    transitLayer.setMap(map);

    var contentString = '<%= @post.map&.address %>';
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });

    var marker = new google.maps.Marker({
                  position:test,
                  map: map,
                  title: contentString
                 });

     marker.addListener('click', function() {
       infowindow.open(map, marker);
     });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>

<div class="col-md-10 col-md-offset-1 mx-auto postShow-wrap">
  <div class="row post-wrap">
    <div class="col-md-9 col-sm-9 col-xs-7 mx-auto">
      <div class="card-left">
        <%= image_tag @post.photos.first.image.url(:medium),class: "card-img-top", alt: "no image" if @post.photos.present? %>
      </div>
    </div>
    <div class="card-show col-md-9 col-sm-9 col-xs-7 mx-auto mt-3">
      <div class="card-right">
        <div class="card-right-comment">
          <div class="card-right-name">
            <%= link_to user_path(@post.user), class: "no-text-decoration" do %>
            <%= image_tag @post.user.profile_photo_url, class: "post-profile-icon" %>
            <% end %>
            <%= link_to user_path(@post.user), class: "black-color no-text-decoration post-user-name",
              title: @post.user.name do %>
              <strong><%= @post.user.name %></strong>
            <% end %>
            <% if @post.user_id == current_user.id %>
              <%= link_to edit_post_path(@post), method: :get, class: "delete-post-icon-outline ml-auto mx-0 my-auto" do %>
                <div class="edit-post-icon"></div>
              <% end %>
              <%= link_to post_path(@post), method: :delete, class: "delete-post-icon-outline ml-auto mx-0 my-auto" do %>
                <div class="delete-post-icon"></div>
              <% end %>
            <% end %>
          </div>
          <div class="m-2">
            <strong><%= @post.caption %></strong>
          </div>
          <div class="comment-post-id">
            <div class="m-2">
              <div id="comment-post-<%= @post.id.to_s %>">
                <%= render 'comment_list', post: @post %>
              </div>
            </div>
          </div>
        </div>
        <div class="parts">
          <div id="like-icon-post-<%= @post.id.to_s %>">   
            <% if @post.liked_by(current_user).present? %>
              <%= link_to "いいねを取り消す", post_like_path(@post.id, @post.liked_by(current_user)), method: :DELETE, remote: true, class: "loved hide-text" %>
            <% else %>
              <%= link_to "いいね", post_likes_path(@post), method: :POST, remote: true, class: "love hide-text" %>
            <% end %>
          </div>                  
          <div id="like-text-post-<%= @post.id.to_s %>">
            <%= @post.likes.count %>
          </div>
          <div class="show-post-time"><%= time_ago_in_words(@post.created_at).upcase %>前</div>
        </div>
      </div>
    </div>
  </div>
</div>
